<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org" >
<head>
<link rel="stylesheet" type="text/css" th:href="@{/css/style.css}">
<meta charset="utf-8" />
</head>
<body>
    <th:block fragment="content">
    <div class="card-content">
		<form id ="form" class="form-horizontal">
			<div class="form-group">
				<label for="title" class="col-sm-2 control-label">제목</label>
				<div class="col-sm-10">
					<input type="text" id="title" class="form-control" placeholder="제목을 입력해 주세요." />
				</div>
			</div>

			<div class="form-group">
				<label for="author" class="col-sm-2 control-label">작성자</label>
				<div class="col-sm-10">
					<input type="text" id="author" class="form-control" placeholder="작성자을 입력해 주세요!." />
				</div>
			</div>

			<div class="form-group">
				<label for="content" class="col-sm-2 control-label">내용</label>
				<div class="col-sm-10">
					<textarea id="content" class="form-control" placeholder="내용을 입력해 주세요."></textarea>
				</div>
			</div>

			<div class="btn_wrap text-center">
				<a th:href="@{/post/list}" class="btn btn-default waves-effect waves-light">뒤로가기</a>
				<button type="button" class="btn btn-primary waves-effect waves-light">저장하기</button>
			</div>
		</form>
	</div>
    </th:block>
    <th:block fragment="scripts">
    <script th:inline="javascript">
	/*<![CDATA[*/
		
		/**
		 * 유효성 검사 
		 */
		 function isValid() {
			const form = document.getElementById('form');
			
			if(!form.title.value.trim()) {
				alert('제목을 입력해 주세요!');
				form.title.value ='';
				form.title.focus();
				return false;
			}
			
			if(!form.author.value.trim()) {
				alert('작성자를 입력해 주세요!');
				form.author.value ='';
				form.author.focus();
				return false;
			}
			
			if(!form.content.value.trim()) {
				alert('내용을 입력해 주세요!');
				form.content.value='';
				form.content.focus();
				return false;
			}
			return true;
	}
	
		/**
		 *게시글 등록 (생성/수정)
		 */
	 	function save () {
			if(!isValid() ){
				return false;
			}
			const form = document.getElementById('form');
			const params = {
					title: form.title.value,
					author:form.author.value,
					content:form.content.value		
			};
			
			fetch('/api/post', {
				method:'POST',
				headers:{
					'Content-Type': 'application/json',
				},
				body: JSON.stringify(params)	
			}).then(response => {
				if(!responsce.ok) {
					throw new Error('Request failed.....');	
				}
				alert('저장되었습니다!');
				location.href='/post/list'
				
			}).catch(error => {
				alert('오류가 발생하였습니다.');
			});
			
		}
		

		

	/*]]>*/
    </script>
    </th:block>

</html>